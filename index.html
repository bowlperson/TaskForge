<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TaskForge â€” Gamified Productivity</title>
  <meta name="description" content="Turn your day into an RPG. Create quests, earn XP, and level up Main Stats + Skills." />
  <!-- Tailwind via CDN for quick prototyping -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'%3E%3Cdefs/%3E%3Crect width='256' height='256' rx='56' fill='%230ea5e9'/%3E%3Cpath fill='white' d='M72 188h112a8 8 0 0 0 7.6-5.5l16-48A8 8 0 0 0 200.1 124H136V80h32a8 8 0 0 0 0-16h-40a8 8 0 0 0-8 8v52H55.9a8 8 0 0 0-7.5 10.5l16 48A8 8 0 0 0 72 188Zm59.9-48 14.7 40h-41.2l14.7-40Z'/%3E%3Ctext x='50%25' y='86%25' text-anchor='middle' font-size='36' fill='white' font-family='monospace'%3ETaskForge%3C/text%3E%3C/svg%3E" />
  <style>
    * { scrollbar-width: thin; }
  </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">
  <div class="max-w-6xl mx-auto p-4 md:p-8">
    <header class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
      <h1 class="text-3xl font-bold">TaskForge <span class="text-sky-400">Beta</span></h1>
      <div class="flex gap-2">
        <button id="btn-export" class="px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700">Export Save</button>
        <label class="px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 cursor-pointer">Import Save
          <input id="file-import" type="file" accept="application/json" class="hidden" />
        </label>
        <button id="btn-reset" class="px-3 py-2 rounded-lg bg-rose-700 hover:bg-rose-600">Hard Reset</button>
      </div>
    </header>

    <section class="mt-6 grid md:grid-cols-3 gap-6">
      <!-- Player Card (persistent left pane) -->
      <div class="md:col-span-1">
        <div class="rounded-2xl bg-slate-900/60 ring-1 ring-white/10 p-4">
          <h2 class="text-xl font-semibold mb-3 flex items-center justify-between">
            Player
            <button id="btn-notify" class="text-xs px-2 py-1 rounded bg-sky-700 hover:bg-sky-600">Enable Notifications</button>
          </h2>
          <div class="space-y-2">
            <label class="block text-sm opacity-80">Name</label>
            <input id="player-name" type="text" class="w-full px-3 py-2 rounded bg-slate-800" placeholder="Bowl" />
            <div class="grid grid-cols-2 gap-2 mt-2">
              <div class="rounded bg-slate-800 p-3">
                <div class="text-3xl font-bold" id="level">1</div>
                <div class="text-xs opacity-70">Level</div>
              </div>
              <div class="rounded bg-slate-800 p-3">
                <div class="text-3xl font-bold" id="xp">0</div>
                <div class="text-xs opacity-70">XP</div>
              </div>
            </div>
            <div class="mt-3 text-xs opacity-90">Next level at <span id="next-xp">100</span> XP</div>

            <!-- Main Stats (click to open page on right) -->
            <div class="mt-4">
              <button id="btn-open-stats" class="w-full text-left font-semibold mb-2 hover:text-sky-300">Main Stats</button>
              <div id="mainstats-list" class="grid grid-cols-2 gap-2"></div>
              <div class="text-xs opacity-75 mt-2">Click +/- to tweak. For detailed chart & add-new, open <span class="underline">Main Stats</span>.</div>
            </div>

            <!-- Skills (click to open page on right) -->
            <div class="mt-4">
              <button id="btn-open-skills" class="w-full text-left font-semibold mb-2 hover:text-sky-300">Skills</button>
              <div id="skills-mini" class="space-y-1 max-h-24 overflow-auto pr-1"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Pane: Views -->
      <div class="md:col-span-2">
        <div class="rounded-2xl bg-slate-900/60 ring-1 ring-white/10 p-4 min-h-[420px]" id="view-container">
          <!-- Quests View (default) -->
          <div id="view-quests">
            <h2 class="text-xl font-semibold mb-3">Quests</h2>
            <form id="quest-form" class="grid grid-cols-1 md:grid-cols-6 gap-2 items-end">
              <div class="md:col-span-2">
                <label class="text-sm opacity-80">Title</label>
                <input id="q-title" class="w-full px-3 py-2 rounded bg-slate-800" placeholder="Gym: Push Day" />
              </div>
              <div>
                <label class="text-sm opacity-80">XP</label>
                <input id="q-xp" type="number" min="0" step="5" class="w-full px-3 py-2 rounded bg-slate-800" value="25" />
              </div>
              <div>
                <label class="text-sm opacity-80">Main Stat</label>
                <select id="q-stat" class="w-full px-3 py-2 rounded bg-slate-800"></select>
              </div>
              <div>
                <label class="text-sm opacity-80">Skill (optional)</label>
                <select id="q-skill" class="w-full px-3 py-2 rounded bg-slate-800"></select>
              </div>
              <div>
                <label class="text-sm opacity-80">Remind</label>
                <input id="q-due" type="datetime-local" class="w-full px-3 py-2 rounded bg-slate-800" />
              </div>
              <div class="md:col-span-6">
                <label class="text-sm opacity-80">Notes</label>
                <textarea id="q-notes" class="w-full px-3 py-2 rounded bg-slate-800" rows="2" placeholder="What does success look like?"></textarea>
              </div>
              <div class="md:col-span-6 flex gap-2">
                <button class="px-4 py-2 rounded bg-emerald-700 hover:bg-emerald-600">Add Quest</button>
                <button type="button" id="btn-clear-done" class="px-4 py-2 rounded bg-slate-800 hover:bg-slate-700">Clear Completed</button>
                <button type="button" id="btn-demo" class="px-4 py-2 rounded bg-slate-800 hover:bg-slate-700">Add Demo Quests</button>
              </div>
            </form>

            <div id="quest-list" class="mt-4 grid gap-3"></div>
          </div>

          <!-- Main Stats View -->
          <div id="view-stats" class="hidden">
            <div class="flex flex-col md:flex-row gap-4">
              <div class="flex-1">
                <h2 class="text-xl font-semibold mb-3">Main Stats</h2>
                <div id="stats-list" class="space-y-2"></div>
                <form id="stat-form" class="flex gap-2 mt-3">
                  <input id="stat-name" type="text" class="flex-1 px-3 py-2 rounded bg-slate-800" placeholder="Add another main stat (e.g., Luck)" />
                  <button class="px-3 py-2 rounded bg-sky-700 hover:bg-sky-600">Add</button>
                </form>
              </div>
              <div class="md:w-1/2">
                <h3 class="font-semibold mb-2">Stat Web</h3>
                <div class="bg-slate-800 rounded-xl p-4">
                  <svg id="radar" viewBox="0 0 200 200" class="w-full h-[260px]"></svg>
                </div>
              </div>
            </div>
          </div>

          <!-- Skills View -->
          <div id="view-skills" class="hidden">
            <h2 class="text-xl font-semibold mb-3">Skills</h2>
            <div id="skills-list" class="space-y-2"></div>
            <form id="skill-form" class="flex gap-2 mt-2">
              <input id="skill-name" type="text" class="flex-1 px-3 py-2 rounded bg-slate-800" placeholder="e.g., Science" />
              <button class="px-3 py-2 rounded bg-sky-700 hover:bg-sky-600">Add</button>
            </form>
          </div>
        </div>
      </div>
    </section>

    <footer class="mt-10 text-xs opacity-60">
      <p>All data is stored locally in your browser (localStorage). Export JSON for backup or sync.</p>
    </footer>
  </div>

  <template id="tpl-quest">
    <div class="rounded-xl bg-slate-800 p-3 ring-1 ring-white/10">
      <div class="flex items-start justify-between gap-3">
        <div class="flex-1">
          <div class="flex items-center gap-2">
            <input type="checkbox" class="q-done size-5 accent-emerald-500" />
            <h3 class="q-title font-semibold"></h3>
            <span class="ml-2 text-xs px-2 py-0.5 rounded bg-sky-700/50">+<span class="q-xp"></span> XP</span>
            <span class="ml-1 text-xs px-2 py-0.5 rounded bg-fuchsia-700/40 q-tag-stat"></span>
            <span class="ml-1 text-xs px-2 py-0.5 rounded bg-amber-700/40 q-tag-skill hidden"></span>
          </div>
          <p class="q-notes text-sm opacity-85 mt-1"></p>
          <div class="q-remind text-xs opacity-70 mt-1"></div>
        </div>
        <div class="flex gap-2">
          <button class="q-edit px-3 py-1 rounded bg-slate-700 hover:bg-slate-600 text-sm">Edit</button>
          <button class="q-del px-3 py-1 rounded bg-rose-700 hover:bg-rose-600 text-sm">Delete</button>
        </div>
      </div>
    </div>
  </template>

  <script>
    // --- Simple data layer ---
    const DEFAULT_SAVE = {
      player: {
        name: "Bowl",
        level: 1,
        xp: 0,
        mainstats: { 
          Strength: 10,
          Dexterity: 10,
          Constitution: 10,
          Intelligence: 10,
          Wisdom: 10,
          Charisma: 10
        },
        skills: { },
      },
      quests: []
    };

    const el = (id) => document.getElementById(id);
    const $ = (sel, root=document) => root.querySelector(sel);

    function load(){
      try{
        const data = JSON.parse(localStorage.getItem('taskforge_save')) || structuredClone(DEFAULT_SAVE);
        // Migrate from old SPECIAL save if present
        const old = JSON.parse(localStorage.getItem('questrpg_save')||'null');
        if(old && old.player){
          if(old.player.special){
            // Map SPECIAL to D&D-ish defaults
            const mapped = {
              Strength: old.player.special.S ?? 10,
              Dexterity: old.player.special.A ?? 10,
              Constitution: old.player.special.E ?? 10,
              Intelligence: old.player.special.I ?? 10,
              Wisdom: old.player.special.P ?? 10,
              Charisma: old.player.special.C ?? 10,
            };
            data.player.mainstats = Object.assign(mapped, data.player.mainstats);
          }
          if(Object.keys(old.player.skills||{}).length){
            data.player.skills = Object.assign({}, old.player.skills);
          }
          if((old.quests||[]).length){
            data.quests = old.quests.map(q=>({
              ...q,
              stat: statKeyToName(q.stat)
            }));
          }
          // one-time import
          localStorage.removeItem('questrpg_save');
        }
        return data;
      }catch(e){
        return structuredClone(DEFAULT_SAVE);
      }
    }
    function save(state){
      localStorage.setItem('taskforge_save', JSON.stringify(state));
    }

    const state = load();

    // --- Helpers ---
    function nextLevelXP(level){ return 100 * level; }
    function statKeyToName(k){
      const map = {S:'Strength', P:'Wisdom', E:'Constitution', C:'Charisma', I:'Intelligence', A:'Dexterity', L:'Luck'};
      return map[k] || k;
    }

    // --- Notifications ---
    async function ensureNotifyPermission(){
      if(!('Notification' in window)) { alert('Notifications not supported in this browser.'); return false; }
      let perm = Notification.permission;
      if(perm === 'default') perm = await Notification.requestPermission();
      return perm === 'granted';
    }
    function notify(title, body){
      try{ new Notification(title, { body }); } catch(e){ }
    }

    // --- Views switching ---
    function show(view){
      for(const id of ['view-quests','view-stats','view-skills']){
        el(id).classList.toggle('hidden', id!==view);
      }
    }

    // --- Renderers ---
    function renderPlayer(){
      el('player-name').value = state.player.name;
      el('level').textContent = state.player.level;
      el('xp').textContent = state.player.xp;
      el('next-xp').textContent = nextLevelXP(state.player.level);

      // Mini mainstats list
      const wrap = el('mainstats-list');
      wrap.innerHTML = '';
      for(const [name, val] of Object.entries(state.player.mainstats)){
        const row = document.createElement('div');
        row.className = 'flex items-center justify-between gap-2 rounded bg-slate-800 p-2';
        row.innerHTML = `
          <span class="text-sm">${name}</span>
          <div class="flex items-center gap-1">
            <button class="px-2 py-1 bg-slate-700 rounded" data-name="${name}" data-delta="-1">-</button>
            <span class="w-10 text-center">${val}</span>
            <button class="px-2 py-1 bg-slate-700 rounded" data-name="${name}" data-delta="1">+</button>
          </div>`;
        const [minus, , plus] = row.querySelectorAll('button');
        minus.addEventListener('click', ()=>{ state.player.mainstats[name]=Math.max(1, state.player.mainstats[name]-1); save(state); renderAll(); });
        plus.addEventListener('click', ()=>{ state.player.mainstats[name]=state.player.mainstats[name]+1; save(state); renderAll(); });
        wrap.appendChild(row);
      }

      // Skills mini list
      const sm = el('skills-mini'); sm.innerHTML='';
      const entries = Object.entries(state.player.skills);
      if(entries.length===0){ sm.innerHTML = '<div class="text-xs opacity-70">No skills yet.</div>'; }
      else{
        for(const [name, val] of entries){
          const d=document.createElement('div');
          d.className='flex items-center justify-between gap-2';
          d.innerHTML = `<span class='text-sm'>${name}</span><span class='text-xs opacity-75'>${val}</span>`;
          sm.appendChild(d);
        }
      }

      // Populate Quest selects
      const statSel = el('q-stat');
      statSel.innerHTML = '<option value="">None</option>' +
        Object.keys(state.player.mainstats).map(n=>`<option value="${n}">${n}</option>`).join('');
      const skillSel = el('q-skill');
      skillSel.innerHTML = '<option value="">None</option>' +
        Object.keys(state.player.skills).map(n=>`<option value="${n}">${n}</option>`).join('');
    }

    function renderQuests(){
      const list = el('quest-list'); list.innerHTML = '';
      const tpl = el('tpl-quest');
      if(state.quests.length === 0){
        list.innerHTML = '<div class="text-sm opacity-70">No quests yet. Add one above. âœ…</div>';
        return;
      }
      for(const q of state.quests){
        const node = tpl.content.cloneNode(true);
        $('.q-title', node).textContent = q.title;
        $('.q-xp', node).textContent = q.xp;
        $('.q-notes', node).textContent = q.notes || '';
        const statTag = $('.q-tag-stat', node);
        statTag.textContent = q.stat || 'â€”';
        const skillTag = $('.q-tag-skill', node);
        if(q.skill){ skillTag.textContent = q.skill; skillTag.classList.remove('hidden'); }
        const box = $('.q-done', node);
        box.checked = !!q.done;
        if(q.due){
          const when = new Date(q.due);
          $('.q-remind', node).textContent = `Reminder: ${when.toLocaleString()}`;
        }
        const wrapper = node.querySelector(':scope > .rounded-xl');
        if(q.done) wrapper.classList.add('opacity-60');

        box.addEventListener('change', ()=>{
          q.done = box.checked;
          if(q.done){
            award(q);
            notify('Quest Complete âœ¨', `${q.title} (+${q.xp} XP)`);
          }
          save(state); renderAll();
        });
        $('.q-del', node).addEventListener('click', ()=>{
          state.quests = state.quests.filter(x=>x.id!==q.id); save(state); renderQuests();
        });
        $('.q-edit', node).addEventListener('click', ()=>{
          el('q-title').value = q.title;
          el('q-xp').value = q.xp;
          el('q-stat').value = q.stat || '';
          el('q-skill').value = q.skill || '';
          el('q-notes').value = q.notes || '';
          el('q-due').value = q.due ? new Date(q.due).toISOString().slice(0,16) : '';
          el('quest-form').dataset.editing = q.id;
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        list.appendChild(node);
      }
    }

    // Radar chart (vanilla SVG)
    function drawRadar(){
      const svg = el('radar'); if(!svg) return;
      const names = Object.keys(state.player.mainstats);
      const values = names.map(n=> state.player.mainstats[n]);
      const max = Math.max(10, ...values);
      const cx=100, cy=100, r=80, steps=4;
      svg.innerHTML='';
      // grid rings
      for(let i=1;i<=steps;i++){
        const rr = (r*i/steps);
        const circle = document.createElementNS('http://www.w3.org/2000/svg','circle');
        circle.setAttribute('cx', cx); circle.setAttribute('cy', cy); circle.setAttribute('r', rr);
        circle.setAttribute('fill','none'); circle.setAttribute('stroke','#334155'); circle.setAttribute('stroke-width','1');
        svg.appendChild(circle);
      }
      // axes + labels
      names.forEach((name, idx)=>{
        const angle = (Math.PI*2*idx/names.length) - Math.PI/2;
        const x = cx + Math.cos(angle)*r;
        const y = cy + Math.sin(angle)*r;
        const line = document.createElementNS('http://www.w3.org/2000/svg','line');
        line.setAttribute('x1', cx); line.setAttribute('y1', cy);
        line.setAttribute('x2', x); line.setAttribute('y2', y);
        line.setAttribute('stroke', '#334155'); line.setAttribute('stroke-width','1');
        svg.appendChild(line);
        const lx = cx + Math.cos(angle)*(r+10);
        const ly = cy + Math.sin(angle)*(r+10);
        const label = document.createElementNS('http://www.w3.org/2000/svg','text');
        label.setAttribute('x', lx); label.setAttribute('y', ly);
        label.setAttribute('fill', '#e2e8f0');
        label.setAttribute('font-size', '10');
        label.setAttribute('text-anchor', Math.cos(angle)>0.2 ? 'start' : (Math.cos(angle)<-0.2 ? 'end':'middle'));
        label.textContent = name;
        svg.appendChild(label);
      });
      // polygon
      const pts = names.map((name, idx)=>{
        const val = state.player.mainstats[name];
        const ratio = Math.max(0, Math.min(1, val / max));
        const angle = (Math.PI*2*idx/names.length) - Math.PI/2;
        const x = cx + Math.cos(angle)*r*ratio;
        const y = cy + Math.sin(angle)*r*ratio;
        return `${x},${y}`;
      }).join(' ');
      const poly = document.createElementNS('http://www.w3.org/2000/svg','polygon');
      poly.setAttribute('points', pts);
      poly.setAttribute('fill', '#0ea5e955');
      poly.setAttribute('stroke', '#0ea5e9');
      poly.setAttribute('stroke-width', '2');
      svg.appendChild(poly);
    }

    function award(q){
      state.player.xp += Number(q.xp)||0;
      while(state.player.xp >= nextLevelXP(state.player.level)){
        state.player.xp -= nextLevelXP(state.player.level);
        state.player.level += 1;
        notify('Level Up! ðŸš€', `You are now Level ${state.player.level}`);
      }
      if(q.stat && state.player.mainstats[q.stat] != null){
        state.player.mainstats[q.stat] += 1;
      }
      if(q.skill){
        state.player.skills[q.skill] = (state.player.skills[q.skill]||0) + Math.max(1, Math.floor(q.xp/25));
      }
    }

    // --- Events ---
    el('player-name').addEventListener('change', e=>{ state.player.name = e.target.value || 'Player'; save(state); });

    // Views
    el('btn-open-stats').addEventListener('click', ()=>{ show('view-stats'); drawRadar(); });
    el('btn-open-skills').addEventListener('click', ()=>{ show('view-skills'); });

    // Stats page controls
    el('stat-form').addEventListener('submit', e=>{
      e.preventDefault();
      const name = el('stat-name').value.trim(); if(!name) return;
      if(state.player.mainstats[name]==null) state.player.mainstats[name]=10;
      save(state); el('stat-name').value=''; renderAll(); show('view-stats'); drawRadar();
    });

    // Skills page controls
    el('skill-form').addEventListener('submit', e=>{
      e.preventDefault();
      const name = el('skill-name').value.trim(); if(!name) return;
      state.player.skills[name] = state.player.skills[name] || 0;
      save(state); el('skill-name').value=''; renderAll(); show('view-skills');
    });

    // Quests form
    el('quest-form').addEventListener('submit', (e)=>{
      e.preventDefault();
      const editing = e.currentTarget.dataset.editing;
      const q = {
        id: editing || crypto.randomUUID(),
        title: el('q-title').value.trim() || 'Untitled Quest',
        xp: Number(el('q-xp').value)||0,
        stat: el('q-stat').value || '',
        skill: el('q-skill').value || '',
        notes: el('q-notes').value.trim(),
        due: el('q-due').value ? new Date(el('q-due').value).toISOString() : '',
        done: false,
      };
      if(editing){
        const idx = state.quests.findIndex(x=>x.id===editing);
        if(idx!==-1) state.quests[idx] = q;
        delete e.currentTarget.dataset.editing;
      } else {
        state.quests.push(q);
      }
      save(state);
      if(q.due && Notification.permission==='granted'){
        const t = new Date(q.due).getTime() - Date.now();
        if(t>0){ setTimeout(()=> notify('Quest Reminder â°', q.title), t); }
      }
      el('q-title').value = '';
      el('q-xp').value = 25;
      el('q-stat').value = '';
      el('q-skill').value = '';
      el('q-notes').value = '';
      el('q-due').value = '';
      renderAll();
    });

    el('btn-clear-done').addEventListener('click', ()=>{ state.quests = state.quests.filter(q=>!q.done); save(state); renderQuests(); });

    el('btn-demo').addEventListener('click', ()=>{
      const demo = [
        {title:'Morning Routine', xp:15, stat:'Dexterity', skill:'Discipline', notes:'Water + Vitamins', due:''},
        {title:'Gym â€” Push Day', xp:35, stat:'Strength', skill:'Fitness', notes:'Bench 3x8', due:''},
        {title:'Study JS (30m)', xp:25, stat:'Intelligence', skill:'JavaScript', notes:'Array methods', due:''},
      ].map(d=>({id:crypto.randomUUID(), done:false, ...d}));
      state.quests.push(...demo); save(state); renderAll();
    });

    el('btn-export').addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'taskforge-save.json'; a.click(); URL.revokeObjectURL(url);
    });

    el('file-import').addEventListener('change', async (e)=>{
      const file = e.target.files?.[0]; if(!file) return;
      const text = await file.text();
      try{
        const data = JSON.parse(text);
        if(!data.player || !data.quests) throw new Error('Invalid save file');
        localStorage.setItem('taskforge_save', text);
        Object.assign(state, data);
        renderAll();
      }catch(err){ alert('Import failed: ' + err.message); }
    });

    el('btn-reset').addEventListener('click', ()=>{
      if(confirm('This will delete your local save. Continue?')){
        localStorage.removeItem('taskforge_save');
        Object.assign(state, structuredClone(DEFAULT_SAVE));
        renderAll();
      }
    });

    el('btn-notify').addEventListener('click', async ()=>{
      const ok = await ensureNotifyPermission();
      if(ok) notify('Notifications enabled', 'I will remind you when the page is open.');
    });

    function renderStatsPage(){
      const box = el('stats-list');
      if(!box) return;
      box.innerHTML='';
      for(const [name, val] of Object.entries(state.player.mainstats)){
        const row = document.createElement('div');
        row.className='flex items-center justify-between gap-2 rounded bg-slate-800 p-2';
        row.innerHTML = `
          <div class="flex items-center gap-2"><span class="font-medium">${name}</span></div>
          <div class="flex items-center gap-1">
            <button class="px-2 py-1 bg-slate-700 rounded" data-name="${name}" data-delta="-1">-</button>
            <span class="w-12 text-center">${val}</span>
            <button class="px-2 py-1 bg-slate-700 rounded" data-name="${name}" data-delta="1">+</button>
            <button class="ml-2 px-2 py-1 bg-rose-700 rounded" data-del="${name}">Ã—</button>
          </div>`;
        const [minus, , plus, delBtn] = row.querySelectorAll('button');
        minus.addEventListener('click', ()=>{ state.player.mainstats[name]=Math.max(1, state.player.mainstats[name]-1); save(state); renderAll(); show('view-stats'); drawRadar(); });
        plus.addEventListener('click', ()=>{ state.player.mainstats[name]=state.player.mainstats[name]+1; save(state); renderAll(); show('view-stats'); drawRadar(); });
        delBtn.addEventListener('click', ()=>{ if(confirm(`Remove ${name}?`)){ delete state.player.mainstats[name]; save(state); renderAll(); show('view-stats'); drawRadar(); } });
        box.appendChild(row);
      }
    }

    function renderSkillsPage(){
      const list = el('skills-list'); if(!list) return; list.innerHTML='';
      const entries = Object.entries(state.player.skills);
      if(entries.length===0){ list.innerHTML = '<div class="text-sm opacity-70">No skills yet. Add one above.</div>'; }
      else{
        for(const [name, val] of entries){
          const row = document.createElement('div');
          row.className='flex items-center justify-between gap-2 rounded bg-slate-800 p-2';
          row.innerHTML = `
            <span class="font-medium">${name}</span>
            <div class="flex items-center gap-1">
              <button class="px-2 py-1 bg-slate-700 rounded" data-name="${name}" data-delta="-1">-</button>
              <span class="w-10 text-center">${val}</span>
              <button class="px-2 py-1 bg-slate-700 rounded" data-name="${name}" data-delta="1">+</button>
              <button class="ml-2 px-2 py-1 bg-rose-700 rounded" data-name="${name}" data-del="1">Ã—</button>
            </div>`;
          const [minus, , plus, delBtn] = row.querySelectorAll('button');
          minus.addEventListener('click', ()=>{ state.player.skills[name]=Math.max(0, state.player.skills[name]-1); save(state); renderAll(); show('view-skills'); });
          plus.addEventListener('click', ()=>{ state.player.skills[name]=state.player.skills[name]+1; save(state); renderAll(); show('view-skills'); });
          delBtn.addEventListener('click', ()=>{ delete state.player.skills[name]; save(state); renderAll(); show('view-skills'); });
          list.appendChild(row);
        }
      }
    }

    function renderAll(){
      renderPlayer();
      renderQuests();
      renderStatsPage();
      renderSkillsPage();
      drawRadar();
    }

    // Initial render and default to Quests view
    renderAll();
    show('view-quests');
  </script>
</body>
</html>
